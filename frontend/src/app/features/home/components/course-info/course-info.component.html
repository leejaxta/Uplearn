<app-navbar />
<div class="container-fluid py-4" *ngIf="course">
  <div class="row mb-5 gx-xl-4 justify-content-center">
    <div class="col-md-7">
      <div class="card shadow-sm border-0 rounded-4 overflow-hidden">
        <div class="position-relative">
          <img
            [src]="
              course.image ||
              'https://placehold.co/800x400/4AC8AE/white?text=Course+Image'
            "
            alt="{{ course.title }}"
            class="img-fluid course-header-image"
            style="width: 100%; height: auto"
          />
        </div>

        <div class="card-body p-4">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <h2 class="fw-bold text-dark mb-2">{{ course.title }}</h2>
          </div>

          <div class="d-flex flex-wrap gap-3 mb-4">
            <div class="d-flex align-items-center text-muted">
              <i class="bi bi-collection-play-fill me-2"></i>
              <span>{{ course.topics.length }} topics</span>
            </div>
            <div class="d-flex align-items-center text-muted">
              <i class="bi bi-people-fill me-2"></i>
              <span>{{ courseEnrollment }} students</span>
            </div>
          </div>

          <div
            class="instructor-info d-flex align-items-center mb-4 p-3 bg-light rounded-3 gap-2"
          >
            <div
              class="instructor-avatar rounded-circle d-flex align-items-center justify-content-center bg-theme text-white"
              style="width: 60px; height: 60px; font-size: 1.5rem"
            >
              {{ course.instructorName.charAt(0) }}
            </div>
            <div class="flex-grow-1">
              <p class="mb-0 fw-semibold">Created by</p>
              <p class="mb-0 text-muted fw-bold fs-5">
                {{ course.instructorName }}
              </p>
            </div>
          </div>

          <div class="course-description">
            <h4 class="fw-semibold mb-3 border-bottom pb-2">
              About This Course
            </h4>
            <p class="text-muted lh-lg fs-5">{{ course.description }}</p>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div
        class="card shadow-sm border-0 rounded-4 sticky-top"
        style="top: 75px; z-index: 0"
      >
        <div class="card-body p-4 text-center">
          <div
            class="price-display mb-4 d-flex align-items-center justify-content-center gap-3"
          >
            <h2
              class="fw-bold mb-0"
              [class.text-theme]="course.price === 0"
              [class.text-success]="course.price > 0"
            >
              {{ course.price === 0 ? "Free" : "₹" + course.price }}
            </h2>

            <span
              *ngIf="course.price > 0"
              class="text-muted small"
              style="font-size: 0.9rem"
            >
              (+₹{{ serviceCharge | number : "1.0-0" }} service charge may
              apply)
            </span>
          </div>

          <button
            class="btn btn-theme btn-lg w-100 py-3 mb-3 fs-5 rounded-3 btn-enroll"
            *ngIf="!user?.isInstructor"
            (click)="isEnrolled ? navigateToCourse() : enroll()"
          >
            <i
              class="me-2"
              [ngClass]="isEnrolled ? 'bi bi-mortarboard' : 'bi bi-cart-plus'"
            >
            </i>
            {{
              isEnrolled
                ? "View Course"
                : course.price === 0
                ? "Enroll Now"
                : "Pay with esewa"
            }}
          </button>

          <div class="features-list text-start border-top pt-4">
            <h5 class="fw-semibold mb-3">This course includes:</h5>
            <ul class="list-unstyled">
              <li class="mb-3 d-flex align-items-center">
                <div
                  class="feature-icon rounded-circle bg-light-theme d-flex align-items-center justify-content-center me-3"
                  style="width: 36px; height: 36px"
                >
                  <i class="bi bi-play-circle-fill text-theme"></i>
                </div>
                <span>Lecture videos</span>
              </li>
              <li class="mb-3 d-flex align-items-center">
                <div
                  class="feature-icon rounded-circle bg-light-theme d-flex align-items-center justify-content-center me-3"
                  style="width: 36px; height: 36px"
                >
                  <i class="bi bi-file-text-fill text-theme"></i>
                </div>
                <span>Downloadable resources</span>
              </li>
              <li class="mb-3 d-flex align-items-center">
                <div
                  class="feature-icon rounded-circle bg-light-theme d-flex align-items-center justify-content-center me-3"
                  style="width: 36px; height: 36px"
                >
                  <i class="bi bi-infinity text-theme"></i>
                </div>
                <span>Full lifetime access</span>
              </li>
              <li class="mb-3 d-flex align-items-center">
                <div
                  class="feature-icon rounded-circle bg-light-theme d-flex align-items-center justify-content-center me-3"
                  style="width: 36px; height: 36px"
                >
                  <i class="bi bi-phone text-theme"></i>
                </div>
                <span>Access on mobile and TV</span>
              </li>
              <li class="mb-3 d-flex align-items-center">
                <div
                  class="feature-icon rounded-circle bg-light-theme d-flex align-items-center justify-content-center me-3"
                  style="width: 36px; height: 36px"
                >
                  <i class="bi bi-award text-theme"></i>
                </div>
                <span>Certificate of completion</span>
              </li>
            </ul>
          </div>

          <div class="mt-4">
            <p class="text-muted small">Share this course</p>
            <div class="d-flex justify-content-center gap-2">
              <a
                [href]="
                  'https://www.facebook.com/sharer/sharer.php?u=' + courseUrl
                "
                target="_blank"
                class="btn btn-outline-secondary rounded-circle d-flex align-items-center justify-content-center"
                style="width: 40px; height: 40px"
              >
                <i class="bi bi-facebook"></i>
              </a>

              <a
                [href]="
                  'https://twitter.com/intent/tweet?url=' +
                  courseUrl +
                  '&text=Check out this course!'
                "
                target="_blank"
                class="btn btn-outline-secondary rounded-circle d-flex align-items-center justify-content-center"
                style="width: 40px; height: 40px"
              >
                <i class="bi bi-twitter"></i>
              </a>
              <a
                [href]="
                  'https://www.linkedin.com/sharing/share-offsite/?url=' +
                  courseUrl
                "
                target="_blank"
                class="btn btn-outline-secondary rounded-circle d-flex align-items-center justify-content-center"
                style="width: 40px; height: 40px"
              >
                <i class="bi bi-linkedin"></i>
              </a>
              <button
                (click)="copyCourseLink()"
                class="btn btn-outline-secondary rounded-circle d-flex align-items-center justify-content-center"
                style="width: 40px; height: 40px"
              >
                <i class="bi bi-link-45deg"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row mb-5" *ngIf="topics && topics.length > 0">
    <div class="col-12">
      <div class="card shadow-sm border-0 rounded-4">
        <div class="card-header bg-white py-4">
          <h3 class="fw-bold mb-0 d-flex align-items-center">
            <i class="bi bi-list-check text-theme me-2"></i>
            Course Content
          </h3>
          <p class="text-muted mb-0 mt-2">
            {{ course.topics.length }} lectures •
            {{ numberOfDocuments }} documents
          </p>
        </div>
        <div class="card-body p-0">
          <div class="accordion" id="courseTopicsAccordion">
            <div
              class="accordion-item border-0 border-bottom"
              *ngFor="let topic of topics; let i = index"
            >
              <h2 class="accordion-header" [id]="'heading' + i">
                <button
                  class="accordion-button collapsed py-4"
                  type="button"
                  data-bs-toggle="collapse"
                  [attr.data-bs-target]="'#collapse' + i"
                  aria-expanded="false"
                  [attr.aria-controls]="'collapse' + i"
                >
                  <div class="d-flex align-items-center w-100">
                    <span class="topic-number badge bg-theme me-3">{{
                      i + 1
                    }}</span>
                    <div class="topic-info flex-grow-1 text-start">
                      <h6 class="mb-0 fw-semibold">{{ topic.title }}</h6>
                    </div>
                    <i
                      class="bi bi-chevron-down accordion-arrow text-muted"
                    ></i>
                  </div>
                </button>
              </h2>
              <div
                [id]="'collapse' + i"
                class="accordion-collapse collapse"
                [attr.aria-labelledby]="'heading' + i"
                data-bs-parent="#courseTopicsAccordion"
              >
                <div class="accordion-body bg-light">
                  <p class="text-muted" *ngIf="topic.description">
                    {{ topic.description }}
                  </p>
                  <p class="text-muted fst-italic" *ngIf="!topic.description">
                    No description available for this topic.
                  </p>

                  <div class="mt-3"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row" *ngIf="!topics || topics.length === 0">
    <div class="col-12">
      <div class="card shadow-sm border-0 rounded-4 text-center py-5">
        <i class="bi bi-journal-text display-4 text-muted mb-3"></i>
        <h4 class="fw-semibold text-muted">No Topics Available Yet</h4>
        <p class="text-muted">
          The instructor hasn't added any content to this course yet.
        </p>
      </div>
    </div>
  </div>
</div>

<div class="row mb-5" style="margin: 0" *ngIf="course">
  <div class="col-12">
    <div class="card border-0">
      <div class="card-body p-5">
        <div class="row">
          <div class="col-md-3 text-center mb-4 mb-md-0">
            <h3 class="fw-bold mb-4">About the instructor</h3>
            <div
              class="instructor-avatar mx-auto rounded-circle d-flex align-items-center justify-content-center bg-theme text-white mb-3"
              style="width: 120px; height: 120px; font-size: 3rem"
            >
              {{ course.instructorName.charAt(0) }}
            </div>
            <h4 class="fw-bold">{{ course.instructorName }}</h4>
          </div>
          <div class="col-md-9 d-flex flex-column justify-content-end">
            <p class="fs-5 text-muted lh-lg">
              {{ course.instructorName }} is a seasoned developer with over 10
              years of experience in web development and software engineering.
              Passionate about teaching and knowledge sharing, they have helped
              thousands of students master programming concepts and advance
              their careers.
            </p>

            <div class="row mt-4">
              <div class="col-md-6">
                <div class="d-flex align-items-center">
                  <i class="bi bi-people-fill text-theme me-2 fs-5"></i>
                  <div>
                    <h5 class="mb-0 fw-bold">{{ totalEnrollment }} Students</h5>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="d-flex align-items-center">
                  <i
                    class="bi bi-collection-play-fill text-theme me-2 fs-5"
                  ></i>
                  <div>
                    <h5 class="mb-0 fw-bold">{{ totalCourses }} Courses</h5>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid py-5 text-center" *ngIf="!course">
  <div
    class="spinner-border text-theme"
    role="status"
    style="width: 3rem; height: 3rem"
  >
    <span class="visually-hidden">Loading...</span>
  </div>
  <p class="mt-3 text-muted">Loading course information...</p>
</div>
<div class="toast-container position-fixed bottom-0 end-0 p-3">
  <div *ngIf="showToast()" class="custom-toast">Link copied to clipboard!</div>
</div>
<app-footer />
